<app-loading></app-loading>
<p-fluid>
    <p-card>
        <p-accordion [value]="[]" [multiple]="true">
            <p-accordion-panel value="0">
                <p-accordion-header>
                    <div class="flex items-center justify-between w-full">
                        <b>Bibliografía Básica</b>
                        <p-tag severity="success" value="Completado" class="mr-2" />
                    </div>
                </p-accordion-header>
                <p-accordion-content>
                    <div class="card">
                        <p-toolbar class="mb-4">
                            <div class="p-toolbar-group-left">
                                <button pButton label="Nueva Referencia" icon="pi pi-plus" class="p-button-success"
                                    (click)="openNew()"></button>
                            </div>
                        </p-toolbar>

                        <p-table [value]="references" [tableStyle]="{'min-width': '40rem'}">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 4rem">#</th>
                                    <th>Referencia (APA)</th>
                                    <th style="width: 8rem">Acciones</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-ref let-rowIndex="rowIndex">
                                <tr>
                                    <td>{{ rowIndex + 1 }}</td>
                                    <td>{{ ref.text }}</td>
                                    <td>
                                        <button pButton icon="pi pi-pencil"
                                            class="p-button-rounded p-button-warning mr-2"
                                            (click)="editReference(ref)"></button>
                                        <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger"
                                            (click)="deleteReference(ref)"></button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </p-accordion-content>
            </p-accordion-panel>
        </p-accordion>
    </p-card>
</p-fluid>

<!-- Diálogo de creación/edición -->
<p-dialog header="{{ isEdit ? 'Editar Referencia' : 'Nueva Referencia' }}" [(visible)]="referenceDialog" [modal]="true" [style]="{width: '30rem'}" [closable]="false">
  <div class="p-fluid">
    <div class="field">
      <label for="text">Referencia APA</label>
      <textarea id="text" pInputTextarea rows="4" autoResize="true"></textarea>
      @if(submitted && !reference.text) {
          <small class="p-error">El texto es obligatorio</small>
      }
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveReference()"></button>
  </ng-template>
</p-dialog>